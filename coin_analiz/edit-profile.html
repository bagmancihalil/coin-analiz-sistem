<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Profili Düzenle - Coin Analiz</title>
    <link rel="stylesheet" href="style.css" />
</head>
<body>
    <div class="user-bar">
        <div id="user-menu">
          <span id="username-display" class="user-email">Yükleniyor...</span>
          <div id="dropdown-menu" class="dropdown hidden">
            <div class="menu-item" id="menu-dashboard">📊 Panel</div>
            <div class="menu-item" id="menu-profile">👤 Profil</div>
            <div class="menu-item" id="menu-favorites">⭐ Favoriler</div>
            <div class="menu-item" id="menu-logout">🚪 Çıkış Yap</div>
          </div>
        </div>
    </div>

    <div class="container profile-container">
        <h1>Profili Düzenle</h1>

        <form id="profile-form">
            <div class="form-group">
                <label for="profile-email">E-posta (Değiştirilemez)</label>
                <input type="email" id="profile-email" disabled />
            </div>
            <div class="form-group">
                <label for="profile-username">Kullanıcı Adı</label>
                <input type="text" id="profile-username" placeholder="Görünen adınız..." />
            </div>
            <div class="form-group">
                <label for="profile-bio">Açıklama (Bio)</label>
                <textarea id="profile-bio" rows="4" placeholder="Kendinden bahset..."></textarea>
            </div>
            <button type="submit" class="btn-save" id="btn-save-profile">Profili Kaydet</button>
        </form>

        <hr>

        <form id="password-form">
            <h2>🔐 Şifre Değiştir</h2>
            <div class="form-group">
                <label for="new-password">Yeni Şifre</label>
                <input type="password" id="new-password" placeholder="En az 6 karakter" />
            </div>
            <button type="submit" class="btn-save" id="btn-save-password">Şifreyi Güncelle</button>
        </form>
    </div>

    <script type="module" src="edit-profile.js"></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-auth.js";
        
        const firebaseConfig = {
            apiKey: "AIzaSyDdjLuOBNN9Ad8SEJuYE0gO0521-fqoX0g",
            authDomain: "cointranaliz-802a1.firebaseapp.com",
            projectId: "cointranaliz-802a1",
            storageBucket: "cointranaliz-802a1.firebasestorage.app",
            messagingSenderId: "716928043593",
            appId: "1:716928043593:web:a196f1671c54f7bd594d98"
        };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        onAuthStateChanged(auth, (user) => {
            if (user) {
                document.getElementById("username-display").textContent = user.email;
            } else {
                window.location.href = "login.html";
            }
        });
        
        // Dropdown menü
        const dropdown = document.getElementById("dropdown-menu");
        const emailEl = document.getElementById("username-display");
        emailEl.addEventListener("click", () => dropdown.classList.toggle("hidden"));
        window.addEventListener("click", (e) => {
            if (!e.target.closest("#user-menu")) dropdown.classList.add("hidden");
        });

        // Menü linkleri
        document.getElementById("menu-dashboard").addEventListener("click", () => window.location.href = "index.html");
        // PROFİL linki artık GÖRÜNÜM sayfasına (profile.html) geri döner
        document.getElementById("menu-profile").addEventListener("click", () => window.location.href = "profile.html"); 
        document.getElementById("menu-favorites").addEventListener("click", () => window.location.href = "index.html"); 
        document.getElementById("menu-logout").addEventListener("click", async () => {
            await signOut(auth);
            localStorage.removeItem("loggedInUser");
            window.location.href = "login.html";
        });
    </script>
</body>
</html>